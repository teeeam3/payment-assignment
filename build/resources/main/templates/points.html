<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" th:href="@{/favicon.ico}">
    <title>í¬ì¸íŠ¸ ê²°ì œ - Commerce Demo</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <script src="https://cdn.portone.io/v2/browser-sdk.js"></script>
    <script th:src="@{/js/cookie-util.js}"></script>
    <script th:src="@{/js/app-config.js}"></script>
    <script th:src="@{/js/api-handler.js}"></script>
    <script th:src="@{/js/api-validator.js}"></script>
    <script th:src="@{/js/theme.js}"></script>
    <script th:src="@{/js/portone-sdk.js}"></script>
    <script th:src="@{/js/auth-check.js}"></script>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-container">
            <a href="/" class="navbar-brand">ğŸª CommerceHub</a>
            <ul class="navbar-nav">
                <li><a href="/" class="nav-link">í™ˆ</a></li>
                <li><a href="/pages/shop" class="nav-link">ìƒì </a></li>
                <li><a href="/pages/orders" class="nav-link">ì£¼ë¬¸</a></li>
                <li><a href="/pages/points" class="nav-link active">í¬ì¸íŠ¸</a></li>
                <li><a href="/pages/plans" class="nav-link">í”Œëœ</a></li>
                <li><a href="/pages/subscribe" class="nav-link">êµ¬ë… ì‹ ì²­</a></li>
                <li><a href="/pages/subscriptions" class="nav-link">êµ¬ë… ê´€ë¦¬</a></li>
            </ul>
            <div class="navbar-actions">
                <div class="config-badge-container"></div>
                <button id="theme-toggle" class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <div class="content-area">
            <h1 style="font-size: 2rem; margin-bottom: 2rem;">ğŸ’° í¬ì¸íŠ¸ í¬í•¨ ê²°ì œ</h1>

            <!-- API êµ¬í˜„ ìƒíƒœ ì•ˆë‚´ -->
            <div class="alert alert-info" style="margin-bottom: 1.5rem;">
                <h4 style="margin: 0 0 0.5rem 0; font-size: 1rem;">â„¹ï¸ í¬ì¸íŠ¸ í¬í•¨ ê²°ì œ í…ŒìŠ¤íŠ¸</h4>
                <p style="margin: 0; font-size: 0.875rem; line-height: 1.6;">
                    ì´ í˜ì´ì§€ì—ì„œëŠ” í¬ì¸íŠ¸ë¥¼ í¬í•¨í•œ ê²°ì œë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
                <ul style="margin: 0.5rem 0 0 1.5rem; font-size: 0.875rem; line-height: 1.8;">
                    <li><strong>ì£¼ë¬¸</strong> í˜ì´ì§€: í¬ì¸íŠ¸ ì—†ì´ ê²°ì œ (ê¸°ë³¸ ê²°ì œ í”Œë¡œìš°)</li>
                    <li><strong>í¬ì¸íŠ¸</strong> í˜ì´ì§€ (í˜„ì¬): í¬ì¸íŠ¸ í¬í•¨ ê²°ì œ (í¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸ìš©)</li>
                </ul>
            </div>

            <!-- API êµ¬í˜„ ìƒíƒœ ì•ˆë‚´ -->
            <div class="alert alert-warning" style="margin-bottom: 1.5rem;">
                <h4 style="margin: 0 0 0.5rem 0; font-size: 1rem;">âš ï¸ ë°±ì—”ë“œ API êµ¬í˜„ í•„ìš”</h4>
                <p style="margin: 0; font-size: 0.875rem; line-height: 1.6;">
                    ì´ í˜ì´ì§€ëŠ” ë‹¤ìŒ APIë“¤ì´ êµ¬í˜„ë˜ì–´ì•¼ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤:
                </p>
                <ul id="api-list-points" style="margin: 0.5rem 0 0 1.5rem; font-size: 0.875rem; line-height: 1.8;">
                    <!-- API ëª©ë¡ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </ul>
                <p style="margin: 0.5rem 0 0 0; font-size: 0.75rem; color: var(--text-secondary);">
                    ğŸ’¡ APIê°€ êµ¬í˜„ë˜ì§€ ì•Šìœ¼ë©´ ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ í‘œì‹œë˜ë©°, ìš°ì¸¡ API íŒ¨ë„ì—ì„œ ìì„¸í•œ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
            </div>

            <!-- ê²°ì œ ê³¼ì • í‘œì‹œ -->
            <div id="payment-process-card" class="card" style="display: none; margin-bottom: 1.5rem;">
                <div class="card-header">â³ ê²°ì œ ì§„í–‰ ì¤‘</div>
                <div class="card-body">
                    <div id="payment-steps"></div>
                </div>
            </div>

            <!-- ì£¼ë¬¸ ëª©ë¡ -->
            <div class="card">
                <div class="card-header">
                    ğŸ“¦ ì£¼ë¬¸ ëª©ë¡ (í¬ì¸íŠ¸ ê²°ì œìš©)
                    <button class="btn btn-outline btn-sm" onclick="loadOrders()" style="margin-left: auto;">
                        ğŸ”„ ìƒˆë¡œê³ ì¹¨
                    </button>
                </div>
                <div class="card-body">
                    <div id="orders-container"></div>
                </div>
            </div>
        </div>

        <div class="api-panel">
            <div class="panel-section">
                <h3 class="panel-title">ğŸ“¡ í˜„ì¬ ì—”ë“œí¬ì¸íŠ¸</h3>
                <div id="current-endpoint" class="endpoint-badge">ì•„ì§ ìš”ì²­ ì—†ìŒ</div>
            </div>
            <div class="panel-section">
                <h3 class="panel-title">ğŸ“¤ ìš”ì²­</h3>
                <textarea id="request-body" class="api-textarea"></textarea>
            </div>
            <div class="panel-section">
                <h3 class="panel-title">ğŸ“¥ ì‘ë‹µ</h3>
                <pre id="response-output" class="response-box">ìš”ì²­ ëŒ€ê¸° ì¤‘...</pre>
            </div>
        </div>
    </div>

    <!-- í¬ì¸íŠ¸ ì…ë ¥ ëª¨ë‹¬ -->
    <div id="points-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div class="card" style="width: 90%; max-width: 500px; margin: 0;">
            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                ğŸ’° í¬ì¸íŠ¸ ì‚¬ìš©
                <button class="btn btn-outline btn-sm" onclick="closePointsModal()">âœ•</button>
            </div>
            <div class="card-body" id="modal-main-content">
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">ì£¼ë¬¸ ë²ˆí˜¸</label>
                    <div id="modal-order-number" style="font-size: 1.125rem; color: var(--primary);"></div>
                </div>
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">ì£¼ë¬¸ ê¸ˆì•¡</label>
                    <div id="modal-order-amount" style="font-size: 1.5rem; font-weight: 700;"></div>
                </div>
                <div style="margin-bottom: 1rem;">
                    <label for="points-input" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">ì‚¬ìš©í•  í¬ì¸íŠ¸</label>
                    <input type="number" id="points-input" class="form-input" placeholder="0" min="0" step="100" value="0">
                    <p style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem;">
                        ğŸ’¡ 100P ë‹¨ìœ„ë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤
                    </p>
                </div>
                <div style="margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-md);">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>ì£¼ë¬¸ ê¸ˆì•¡</span>
                        <span id="modal-original-amount" style="font-weight: 600;">-</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; color: var(--danger);">
                        <span>í¬ì¸íŠ¸ ì‚¬ìš©</span>
                        <span id="modal-points-used" style="font-weight: 600;">- 0P</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding-top: 0.5rem; border-top: 2px solid var(--border); font-size: 1.125rem; font-weight: 700;">
                        <span>ìµœì¢… ê²°ì œ ê¸ˆì•¡</span>
                        <span id="modal-final-amount" style="color: var(--primary);">-</span>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="startPaymentWithPoints()" style="width: 100%;">
                    ğŸ’³ ê²°ì œ ì‹œì‘
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let orders = [];
        let selectedOrder = null;

        // API ëª©ë¡ ë™ì  ìƒì„±
        async function populateApiList() {
            const apiListElement = document.getElementById('api-list-points');
            if (!apiListElement) return;

            try {
                // config ë¡œë“œ ëŒ€ê¸°
                const config = await getConfig();
                const endpoints = config?.api?.endpoints;

                if (!endpoints) {
                    apiListElement.innerHTML = '';
                    return;
                }

                // points.htmlì— í•„ìš”í•œ APIë“¤ (ì£¼ë¬¸ ëª©ë¡ + ê²°ì œ ìƒì„±)
                const requiredApis = ['list-orders', 'create-payment'];
                const apiItems = [];

                requiredApis.forEach(apiKey => {
                    const apiConfig = endpoints[apiKey];
                    if (apiConfig && apiConfig.url) {
                        const method = apiConfig.method || 'GET';
                        const description = apiConfig.description || '';
                        apiItems.push(`<li><code>${method} ${apiConfig.url}</code> - ${description}</li>`);
                    }
                });

                // APIê°€ ì •ì˜ë˜ì–´ ìˆìœ¼ë©´ í‘œì‹œ, ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´
                apiListElement.innerHTML = apiItems.join('');
            } catch (error) {
                console.error('API ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                apiListElement.innerHTML = '';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async () => {
            // API ëª©ë¡ ë™ì  ìƒì„± (ë¹„ë™ê¸°)
            populateApiList();

            await loadCurrentUser();
            await loadOrders();

            // í¬ì¸íŠ¸ ì…ë ¥ ë³€ê²½ ì‹œ ìµœì¢… ê¸ˆì•¡ ì—…ë°ì´íŠ¸
            document.getElementById('points-input').addEventListener('input', updateModalAmounts);
        });

        // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
        async function loadCurrentUser() {
            try {
                currentUser = await makeApiRequest('get-current-user', {
                });

                if (!validateApiResponse('get-current-user', currentUser)) {
                    throw new Error('API ì‘ë‹µ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Failed to load user info:', error);
                currentUser = null;
            }
        }

        // ì£¼ë¬¸ ëª©ë¡ ë¡œë“œ
        async function loadOrders() {
            try {
                const result = await makeApiRequest('list-orders', {
                });

                if (!validateApiResponse('list-orders', result)) {
                    return;
                }

                if (result && Array.isArray(result)) {
                    orders = result;
                    renderOrders();
                } else {
                    showNotification('ì£¼ë¬¸ ëª©ë¡ì´ ë°°ì—´ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤', 'error');
                }
            } catch (error) {
                console.error('Failed to load orders:', error);
                showNotification('ì£¼ë¬¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                document.getElementById('orders-container').innerHTML =
                    '<p style="color: var(--text-secondary); text-align: center; padding: 2rem;">ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</p>';
            }
        }

        // ì£¼ë¬¸ ëª©ë¡ ë Œë”ë§
        function renderOrders() {
            const container = document.getElementById('orders-container');

            if (orders.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 2rem;">ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }

            // PENDING ìƒíƒœì˜ ì£¼ë¬¸ë§Œ í•„í„°ë§
            const pendingOrders = orders.filter(order => order.status === 'PENDING');

            if (pendingOrders.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 2rem;">ê²°ì œ ëŒ€ê¸° ì¤‘ì¸ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }

            const ordersHtml = pendingOrders.map(order => {
                const statusClass = order.status === 'PENDING' ? 'warning' :
                                  order.status === 'PAID' ? 'success' : 'secondary';

                return `
                    <div style="padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-md); margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                            <div>
                                <div style="font-weight: 700; font-size: 1.125rem; margin-bottom: 0.25rem;">
                                    ${order.orderNumber}
                                </div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary);">
                                    ${new Date(order.createdAt || Date.now()).toLocaleString()}
                                </div>
                            </div>
                            <span class="badge badge-${statusClass}">${order.status}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 0.75rem; border-top: 1px solid var(--border);">
                            <div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.25rem;">
                                    ì£¼ë¬¸ ê¸ˆì•¡
                                </div>
                                <div style="font-size: 1.5rem; font-weight: 700;">
                                    ${order.totalAmount.toLocaleString()}ì›
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick='openPointsModal("${order.orderId}")'>
                                ğŸ’° í¬ì¸íŠ¸ë¡œ ê²°ì œ
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = ordersHtml;
        }

        // í¬ì¸íŠ¸ ëª¨ë‹¬ ì—´ê¸°
        function openPointsModal(orderId) {
            // orders ë°°ì—´ì—ì„œ orderIdë¡œ ì£¼ë¬¸ ì°¾ê¸°
            const order = orders.find(o => o.orderId === orderId);

            if (!order) {
                showNotification('ì£¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            selectedOrder = order;
            document.getElementById('modal-order-number').textContent = order.orderNumber;
            document.getElementById('modal-order-amount').textContent = order.totalAmount.toLocaleString() + 'ì›';
            document.getElementById('points-input').value = 0;

            updateModalAmounts();

            const modal = document.getElementById('points-modal');
            modal.style.display = 'flex';
        }

        // í¬ì¸íŠ¸ ëª¨ë‹¬ ë‹«ê¸°
        function closePointsModal() {
            const modal = document.getElementById('points-modal');
            modal.style.display = 'none';
            selectedOrder = null;
        }

        // ëª¨ë‹¬ ê¸ˆì•¡ ì—…ë°ì´íŠ¸
        function updateModalAmounts() {
            if (!selectedOrder) return;

            const points = parseInt(document.getElementById('points-input').value) || 0;
            const originalAmount = selectedOrder.totalAmount;
            const finalAmount = Math.max(0, originalAmount - points);

            document.getElementById('modal-original-amount').textContent = originalAmount.toLocaleString() + 'ì›';
            document.getElementById('modal-points-used').textContent = '- ' + points.toLocaleString() + 'P';
            document.getElementById('modal-final-amount').textContent = finalAmount.toLocaleString() + 'ì›';
        }

        // ê²°ì œ ê³¼ì • í‘œì‹œ ì¹´ë“œ í‘œì‹œ/ìˆ¨ê¹€
        function showPaymentProcess() {
            document.getElementById('payment-process-card').style.display = 'block';
            document.getElementById('payment-steps').innerHTML = '';
        }

        function hidePaymentProcess() {
            document.getElementById('payment-process-card').style.display = 'none';
        }

        // ê²°ì œ ë‹¨ê³„ ì¶”ê°€
        function addPaymentStep(step, status = 'loading') {
            const stepsContainer = document.getElementById('payment-steps');
            const stepId = `step-${Date.now()}`;

            const statusIcons = {
                loading: 'â³',
                success: 'âœ…',
                error: 'âŒ'
            };

            const statusColors = {
                loading: 'var(--warning)',
                success: 'var(--success)',
                error: 'var(--danger)'
            };

            const stepHtml = `
                <div id="${stepId}" style="padding: 0.75rem; background: var(--bg-secondary); border-radius: var(--radius-md); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.75rem;">
                    <span style="font-size: 1.25rem;">${statusIcons[status]}</span>
                    <span style="flex: 1; color: ${statusColors[status]};">${step}</span>
                </div>
            `;

            stepsContainer.insertAdjacentHTML('beforeend', stepHtml);
            return stepId;
        }

        // ê²°ì œ ë‹¨ê³„ ì—…ë°ì´íŠ¸
        function updatePaymentStep(stepId, status, message = null) {
            const stepElement = document.getElementById(stepId);
            if (!stepElement) return;

            const statusIcons = {
                loading: 'â³',
                success: 'âœ…',
                error: 'âŒ'
            };

            const statusColors = {
                loading: 'var(--warning)',
                success: 'var(--success)',
                error: 'var(--danger)'
            };

            const icon = stepElement.querySelector('span:first-child');
            const text = stepElement.querySelector('span:last-child');

            icon.textContent = statusIcons[status];
            text.style.color = statusColors[status];
            if (message) {
                text.textContent = message;
            }
        }

        // í¬ì¸íŠ¸ í¬í•¨ ê²°ì œ ì‹œì‘
        async function startPaymentWithPoints() {
            if (!selectedOrder) {
                showNotification('ì£¼ë¬¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            if (!currentUser) {
                showNotification('ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            const points = parseInt(document.getElementById('points-input').value) || 0;

            if (points < 0) {
                showNotification('í¬ì¸íŠ¸ëŠ” 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤', 'error');
                return;
            }

            if (points % 100 !== 0) {
                showNotification('í¬ì¸íŠ¸ëŠ” 100P ë‹¨ìœ„ë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤', 'error');
                return;
            }

            if (points > selectedOrder.totalAmount) {
                showNotification('ì‚¬ìš© í¬ì¸íŠ¸ê°€ ì£¼ë¬¸ ê¸ˆì•¡ë³´ë‹¤ í´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            // ê²°ì œ ê³¼ì • í‘œì‹œ ì‹œì‘
            showPaymentProcess();

            let step1, step2, step3;

            try {
                const orderToProcess = {
                    orderId: selectedOrder.orderId,
                    orderNumber: selectedOrder.orderNumber,
                    totalAmount: selectedOrder.totalAmount,
                    currency: selectedOrder.currency || 'KRW'
                };

                // ëª¨ë‹¬ ë‹«ê¸°
                closePointsModal();

                // 1ë‹¨ê³„: ê²°ì œ ìƒì„± ë° PortOne SDK í˜¸ì¶œ (openPortOnePayment ì‚¬ìš©)
                const finalAmount = Math.max(0, orderToProcess.totalAmount - points);
                step1 = addPaymentStep(`ê²°ì œ ì‹œì‘... (í¬ì¸íŠ¸: ${points.toLocaleString()}P, ìµœì¢… ê¸ˆì•¡: ${finalAmount.toLocaleString()}ì›)`, 'loading');

                const paymentData = {
                    orderId: orderToProcess.orderId,
                    orderName: `ì£¼ë¬¸ ${orderToProcess.orderNumber}`,
                    totalAmount: orderToProcess.totalAmount,
                    pointsToUse: points,  // í¬ì¸íŠ¸ ì •ë³´ ì¶”ê°€
                    currency: orderToProcess.currency,
                    payMethod: 'CARD',
                    customer: {
                        customerId: currentUser.customerUid,
                        fullName: currentUser.name,
                        phoneNumber: currentUser.phone || '01012345678',  // KG ì´ë‹ˆì‹œìŠ¤ í•„ìˆ˜
                        email: currentUser.email
                    }
                };

                // openPortOnePaymentWithPoints í•¨ìˆ˜ ì‚¬ìš© (portone-sdk.js - í¬ì¸íŠ¸ ì „ìš©)
                const paymentResult = await openPortOnePaymentWithPoints(paymentData);

                if (!paymentResult || !paymentResult.paymentId) {
                    updatePaymentStep(step1, 'error', 'ê²°ì œ ì‹¤íŒ¨');
                    return;
                }

                updatePaymentStep(step1, 'success', `ê²°ì œ ì™„ë£Œ (ID: ${paymentResult.paymentId})`);

                // 2ë‹¨ê³„: ê²°ì œ í™•ì • API í˜¸ì¶œ (ìë™)
                step2 = addPaymentStep('ê²°ì œ í™•ì • ì¤‘...', 'loading');

                await confirmPaymentTemplate(paymentResult.paymentId);

                updatePaymentStep(step2, 'success', 'ê²°ì œ í™•ì • ì™„ë£Œ');
                showNotification('ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! (í¬ì¸íŠ¸: ' + points.toLocaleString() + 'P ì‚¬ìš©)', 'success');

                // 3ì´ˆ í›„ ê²°ì œ ê³¼ì • ìˆ¨ê¸°ê¸° ë° ì£¼ë¬¸ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                setTimeout(async () => {
                    hidePaymentProcess();
                    await loadOrders();
                }, 3000);

            } catch (error) {
                console.error('Payment error:', error);
                if (step1 && !step2) {
                    updatePaymentStep(step1, 'error', `ì˜¤ë¥˜: ${error.message}`);
                } else if (step2) {
                    updatePaymentStep(step2, 'error', `ì˜¤ë¥˜: ${error.message}`);
                }
                showNotification(`ê²°ì œ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('points-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePointsModal();
            }
        });
    </script>
</body>
</html>
