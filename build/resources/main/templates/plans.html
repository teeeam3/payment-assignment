<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" th:href="@{/favicon.ico}">
    <title>í”Œëœ - Commerce Demo</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <script th:src="@{/js/cookie-util.js}"></script>
    <script th:src="@{/js/app-config.js}"></script>
    <script th:src="@{/js/api-handler.js}"></script>
    <script th:src="@{/js/api-validator.js}"></script>
    <script th:src="@{/js/theme.js}"></script>
    <script th:src="@{/js/auth-check.js}"></script>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-container">
            <a href="/" class="navbar-brand">ğŸª CommerceHub</a>
            <ul class="navbar-nav">
                <li><a href="/" class="nav-link">í™ˆ</a></li>
                <li><a href="/pages/shop" class="nav-link">ìƒì </a></li>
                <li><a href="/pages/orders" class="nav-link">ì£¼ë¬¸</a></li>
                <li><a href="/pages/points" class="nav-link">í¬ì¸íŠ¸</a></li>
                <li><a href="/pages/plans" class="nav-link active">í”Œëœ</a></li>
                <li><a href="/pages/subscribe" class="nav-link">êµ¬ë… ì‹ ì²­</a></li>
                <li><a href="/pages/subscriptions" class="nav-link">êµ¬ë… ê´€ë¦¬</a></li>
            </ul>
            <div class="navbar-actions">
                <div class="config-badge-container"></div>
                <button id="theme-toggle" class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <div class="content-area">
            <h1 style="font-size: 2rem; margin-bottom: 0.5rem; text-align: center;">â­ êµ¬ë… í”Œëœ</h1>
            <p style="text-align: center; color: var(--text-secondary); margin-bottom: 3rem;">
                í•„ìš”ì— ë§ëŠ” ì™„ë²½í•œ í”Œëœì„ ì„ íƒí•˜ì„¸ìš”
            </p>

            <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë˜ëŠ” í”Œëœ ì¹´ë“œ -->
            <div id="plans-container" class="card-grid" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));">
                <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                    í”Œëœ ë¡œë”© ì¤‘...
                </div>
            </div>

            <div style="margin-top: 3rem; padding: 2rem; background: var(--bg-secondary); border-radius: var(--radius-lg);">
                <h3 style="margin-bottom: 1rem;">ğŸ’¡ í”Œëœ í˜œíƒ</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                    <div>
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ“¦</div>
                        <strong>ë¬´ë£Œ ë°°ì†¡</strong>
                        <p style="color: var(--text-secondary); margin-top: 0.25rem;">ëª¨ë“  í”Œëœì— ë¬´ë£Œ ë°°ì†¡ í¬í•¨</p>
                    </div>
                    <div>
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ’°</div>
                        <strong>ìºì‹œë°±</strong>
                        <p style="color: var(--text-secondary); margin-top: 0.25rem;">êµ¬ë§¤ ì‹œë§ˆë‹¤ í¬ì¸íŠ¸ ì ë¦½</p>
                    </div>
                    <div>
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸŸï¸</div>
                        <strong>ë…ì  ì¿ í°</strong>
                        <p style="color: var(--text-secondary); margin-top: 0.25rem;">ë§¤ì›” í• ì¸ ì¿ í° ì œê³µ</p>
                    </div>
                    <div>
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">âš¡</div>
                        <strong>ìš°ì„  êµ¬ë§¤</strong>
                        <p style="color: var(--text-secondary); margin-top: 0.25rem;">ì‹ ì œí’ˆ ë¨¼ì € êµ¬ë§¤ ê°€ëŠ¥</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="api-panel">
            <div class="panel-section">
                <h3 class="panel-title">ğŸ“¡ í˜„ì¬ ì—”ë“œí¬ì¸íŠ¸</h3>
                <div id="current-endpoint" class="endpoint-badge">ì•„ì§ ìš”ì²­ ì—†ìŒ</div>
            </div>
            <div class="panel-section">
                <h3 class="panel-title">ğŸ“¤ ìš”ì²­</h3>
                <textarea id="request-body" class="api-textarea"></textarea>
            </div>
            <div class="panel-section">
                <h3 class="panel-title">ğŸ“¥ ì‘ë‹µ</h3>
                <pre id="response-output" class="response-box">ìš”ì²­ ëŒ€ê¸° ì¤‘...</pre>
            </div>
        </div>
    </div>

    <script>
        // í”Œëœë³„ ì´ëª¨ì§€ ë§¤í•‘
        const planEmojis = {
            'BASIC': 'ğŸ¥‰',
            'PRO': 'ğŸ¥ˆ',
            'MAX': 'ğŸ¥‡'
        };

        // í”Œëœë³„ ê¸°ë³¸ íŠ¹ì§• (ë°±ì—”ë“œì—ì„œ ì œê³µí•˜ì§€ ì•Šì„ ê²½ìš° ì‚¬ìš©)
        const defaultFeatures = {
            'BASIC': ['ë¬´ë£Œ ë°°ì†¡', 'ê¸°ë³¸ ê³ ê°ì„¼í„°', 'ì›” 10íšŒ í• ì¸ì¿ í°', 'êµ¬ë§¤ ì‹œ 1% ì ë¦½'],
            'PRO': ['ë¬´ë£Œ ë°°ì†¡', 'ìš°ì„  ê³ ê°ì„¼í„°', 'ì›” 30íšŒ í• ì¸ì¿ í°', 'êµ¬ë§¤ ì‹œ 3% ì ë¦½', 'ì‹ ì œí’ˆ ìš°ì„  êµ¬ë§¤'],
            'MAX': ['ë¬´ë£Œ ë°°ì†¡', 'í”„ë¦¬ë¯¸ì—„ ê³ ê°ì„¼í„°', 'ë¬´ì œí•œ í• ì¸ì¿ í°', 'êµ¬ë§¤ ì‹œ 5% ì ë¦½', 'ì‹ ì œí’ˆ ìš°ì„  êµ¬ë§¤', 'VIP ì´ë²¤íŠ¸ ì´ˆëŒ€', 'ì „ìš© ìƒë‹´ì‚¬ ë°°ì •']
        };

        // ì£¼ê¸°ë³„ í‘œì‹œ í…ìŠ¤íŠ¸
        const billingCycleText = {
            'MONTHLY': 'ì›”',
            'QUARTERLY': 'ë¶„ê¸°',
            'ANNUAL': 'ë…„'
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œ í”Œëœ ë¡œë“œ
        document.addEventListener('DOMContentLoaded', loadPlans);

        async function loadPlans() {
            try {
                const plans = await makeApiRequest('list-plans', {
                });

                if (!validateApiResponse('list-plans', plans)) {
                    throw new Error('API ì‘ë‹µ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }

                renderPlans(plans);
            } catch (error) {
                console.error('Failed to load plans:', error);
                showApiNotImplemented();
            }
        }

        function renderPlans(plans) {
            const container = document.getElementById('plans-container');

            if (!plans || plans.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                        ë“±ë¡ëœ í”Œëœì´ ì—†ìŠµë‹ˆë‹¤.
                    </div>
                `;
                return;
            }

            // ì¤‘ê°„ í”Œëœì„ "ì¸ê¸°" í”Œëœìœ¼ë¡œ í‘œì‹œ (3ê°œì¼ ê²½ìš° 2ë²ˆì§¸)
            const popularIndex = Math.floor(plans.length / 2);

            container.innerHTML = plans.map((plan, index) => {
                const isPopular = index === popularIndex && plans.length >= 3;
                const emoji = planEmojis[plan.name?.toUpperCase()] || planEmojis[plan.planId] || 'ğŸ“¦';
                const features = defaultFeatures[plan.name?.toUpperCase()] || ['í”Œëœ í˜œíƒ ì œê³µ'];
                const cycleText = billingCycleText[plan.billingCycle] || 'ì›”';
                const buttonClass = isPopular ? 'btn-primary' : 'btn-outline';
                const cardStyle = isPopular ? 'border-color: var(--primary); border-width: 3px; transform: scale(1.05);' : '';

                return `
                    <div class="plan-card" style="${cardStyle}">
                        ${isPopular ? `
                            <div style="background: var(--primary); color: white; padding: 0.5rem; border-radius: var(--radius-sm); text-align: center; margin-bottom: 1rem; font-weight: 600;">
                                ğŸ”¥ ê°€ì¥ ì¸ê¸° ìˆëŠ”
                            </div>
                        ` : ''}
                        <div style="text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">${emoji}</div>
                            <div class="card-header">${plan.name}</div>
                            <div class="price">â‚©${plan.amount.toLocaleString()}<span style="font-size: 1rem; color: var(--text-secondary);">/${cycleText}</span></div>
                        </div>
                        <ul class="features-list" style="margin: 2rem 0;">
                            ${features.map(feature => `<li class="feature-item">${feature}</li>`).join('')}
                        </ul>
                        <button class="btn ${buttonClass}" onclick="goToSubscribe('${plan.planId}')" style="width: 100%;">
                            ${plan.name} ì„ íƒ
                        </button>
                    </div>
                `;
            }).join('');
        }

        function showApiNotImplemented() {
            const container = document.getElementById('plans-container');
            container.innerHTML = `
                <div style="grid-column: 1 / -1;">
                    <div class="alert alert-warning">
                        <h3>âš ï¸ API ë¯¸êµ¬í˜„</h3>
                        <p><strong>GET /api/plans</strong> ì—”ë“œí¬ì¸íŠ¸ë¥¼ êµ¬í˜„í•´ì£¼ì„¸ìš”.</p>
                        <p>êµ¬ë… í”Œëœ ëª©ë¡ì„ ì¡°íšŒí•˜ëŠ” APIê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
                        <p style="margin-top: 1rem; color: var(--text-secondary);">
                            API êµ¬í˜„ í›„ ì´ í˜ì´ì§€ê°€ ìë™ìœ¼ë¡œ í”Œëœì„ í‘œì‹œí•©ë‹ˆë‹¤.
                        </p>
                    </div>
                </div>
            `;
        }

        function goToSubscribe(planId) {
            window.location.href = `/pages/subscribe?planId=${planId}`;
        }
    </script>
</body>
</html>
