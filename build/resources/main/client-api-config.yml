# ========================================
# 클라이언트 API 계약 설정
# ========================================
# 수강생들이 이 파일을 수정하여 API 계약을 자유롭게 정의할 수 있습니다.
# URL, 필드명, 타입 등을 변경하면 클라이언트가 자동으로 적응합니다.
#
# pathParams 사용법:
# - URL에 경로 파라미터가 있는 경우 pathParams에 정의합니다
# - 예시: url: /api/payments/{paymentId}/confirm
#   pathParams:
#     - name: paymentId
#       description: 결제 ID
#
# 클라이언트에서 사용하는 3가지 방법:
# 1. 객체로 전달 (이름 매핑): pathParams: { paymentId: 'PAY-123' }
# 2. 배열로 전달 (순서 매핑): pathParams: ['PAY-123']
# 3. 단일 값 전달 (첫 번째 파라미터): pathParams: 'PAY-123'
#
#   URL의 파라미터 이름을 변경해도 (예: {id})
#    클라이언트는 방법 2, 3을 사용하면 수정 불필요!

api:
  base-url: http://localhost:8080

  # API 엔드포인트 및 계약 정의
  endpoints:
    # ========================================
    # 인증 (Authentication)
    # ========================================
    login:
      url:
      method:
      description: 사용자 로그인
      request:
        fields:
          - name: email
            type: string
            required: true
            example: admin@test.com
          - name: password
            type: string
            required: true
            example: admin
      response:
        headers:
          - name: Authorization
            required: true
            description: "JWT 토큰 (Bearer {token} 형식)"
        body:
          fields:
            - name: success
              type: boolean
              required: true
              description: 로그인 성공 여부
            - name: email
              type: string
              required: false
              description: 로그인한 사용자 이메일

    register:
      url:
      method:
      description: 회원가입
      request:
        fields:
          - name: name
            type: string
            required: true
          - name: email
            type: string
            required: true
          - name: password
            type: string
            required: true
          - name: phone
            type: string
            required: true
      response:
        body:
          fields:
            - name: success
              type: boolean
              required: true
              description: 회원가입 성공 여부
            - name: message
              type: string
              required: false
              description: 에러 메시지 (실패 시)

    get-current-user:
      url:
      method:
      description: 현재 로그인한 사용자 정보 조회
      response:
        body:
          fields:
            - name: customerUid
              type: string
              required: true
              description: PortOne 고객 고유 식별자 (서버에서 customerUid로 관리)
              usage: PortOne payment window customer.customerId
            - name: email
              type: string
              required: true
              description: 사용자 이메일
              usage: PortOne payment window customer.email
            - name: name
              type: string
              required: true
              description: 사용자 이름
              usage: PortOne payment window customer.fullName
            - name: phone
              type: string
              required: true
              description: 사용자 전화번호 (KG 이니시스 필수)
              usage: PortOne payment window customer.phoneNumber
            - name: pointBalance
              type: number
              required: true
              description: 현재 포인트 잔액

    # ========================================
    # 상품 & 주문 (Product & Order)
    # ========================================
    list-products:
      url:
      method:
      description: 상품 목록 조회
      response:
        body:
          type: array
          items:
            - name: id
              type: string
              required: true
              description: 상품 ID
            - name: name
              type: string
              required: true
              description: 상품명
            - name: price
              type: number
              required: true
              description: 가격
            - name: stock
              type: number
              required: true
              description: 재고 수량

    create-order:
      url:
      method:
      description: 주문 생성 (총 금액은 서버에서 계산)
      request:
        fields:
          - name: items
            type: array
            required: true
            description: "주문 아이템 배열 [{ productId, quantity }] - productId로 상품 조회 후 서버에서 가격 계산"
      response:
        body:
          fields:
            - name: orderId
              type: string
              required: true
              description: 생성된 주문 ID
              usage: 주문 페이지 리다이렉트에 사용
            - name: totalAmount
              type: number
              required: false
              description: 서버에서 계산된 총 금액
            - name: orderNumber
              type: string
              required: false
              description: 생성된 주문 번호

    list-orders:
      url:
      method:
      description: 주문 목록 조회 (현재 로그인한 사용자의 주문)
      response:
        body:
          type: array
          items:
            - name: orderNumber
              type: string
              required: true
              description: 주문 번호 (사용자에게 보이는 주문 번호)
            - name: orderId
              type: string
              required: true
              description: 주문 ID (시스템 고유 식별자)
            - name: totalAmount
              type: number
              required: true
              description: 주문 금액 (포인트 차감 전)
            - name: usedPoints
              type: number
              required: false
              description: 사용한 포인트
            - name: finalAmount
              type: number
              required: false
              description: 최종 결제 금액 (포인트 차감 후)
            - name: earnedPoints
              type: number
              required: false
              description: 적립된 포인트
            - name: currency
              type: string
              required: true
              description: 통화
            - name: status
              type: string
              required: true
              description: 주문 상태 (PENDING, PAID, CANCELLED 등)
            - name: createdAt
              type: string
              required: false
              description: 주문 생성 시간

    # ========================================
    # 결제 (Payment)
    # ========================================
    create-payment:
      url:
      method:
      description: 결제 시작 요청 (DB에 PENDING 상태로 등록, PortOne SDK 호출 전에 먼저 호출)
      request:
        fields:
          - name: orderId
            type: string
            required: true
            description: 주문 ID (서버에서 주문 정보 조회)
          - name: totalAmount
            type: number
            required: true
            description: 결제 금액
          - name: pointsToUse
            type: number
            required: false
            description: "사용할 포인트 (선택 사항, 0 이상)"
      response:
        body:
          fields:
            - name: success
              type: boolean
              required: true
              description: 생성 성공 여부
            - name: paymentId
              type: string
              required: true
              description: 생성된 결제 ID (PortOne SDK에 전달할 ID)
            - name: status
              type: string
              required: false
              description: 결제 상태 (PENDING)

    confirm-payment:
      url:
      method:
      description: 결제 확정 (PortOne 결제 검증 및 주문 상태 업데이트)
      pathParams:
        - name:
          description: 결제 ID
      response:
        body:
          fields:
            - name: success
              type: boolean
              required: true
              description: 확정 성공 여부
            - name: orderId
              type: string
              required: false
              description: 주문 ID
            - name: status
              type: string
              required: false
              description: 변경된 주문 상태

    cancel-payment:
      url:
      method:
      description: 결제 취소/환불 (PortOne 결제 취소 및 주문 상태 업데이트)
      pathParams:
        - name:
          description: 결제 ID
      request:
        fields:
          - name: reason
            type: string
            required: false
            description: 취소 사유
      response:
        body:
          fields:
            - name: success
              type: boolean
              required: true
              description: 취소 성공 여부
            - name: orderId
              type: string
              required: false
              description: 주문 ID
            - name: status
              type: string
              required: false
              description: 변경된 주문 상태

    # ========================================
    # 구독 & 빌링키 (Subscription & Billing Key)
    # ========================================
    list-plans:
      url:
      method:
      description: 구독 플랜 목록 조회
      response:
        body:
          type: array
          items:
            - name: planId
              type: string
              required: true
              description: "플랜 ID (자유 형식: PLAN-PRO, PRO, 1, etc.)"
            - name: name
              type: string
              required: true
              description: 플랜 이름
            - name: amount
              type: number
              required: true
              description: 플랜 금액
            - name: billingCycle
              type: string
              required: true
              description: 결제 주기 (MONTHLY, QUARTERLY, ANNUAL)

    create-subscription:
      url:
      method:
      description: 구독 생성 (빌링키 저장 + 구독 생성을 하나의 트랜잭션으로 처리)
      request:
        fields:
          - name: customerUid
            type: string
            required: true
            description: PortOne 고객 고유 식별자
          - name: planId
            type: string
            required: true
            description: 구독할 플랜 ID
          - name: billingKey
            type: string
            required: true
            description: PortOne에서 발급받은 빌링키 (서버에서 결제수단으로 저장)
          - name: amount
            type: number
            required: true
            description: 구독 금액
      response:
        body:
          fields:
            - name: subscriptionId
              type: string
              required: true
              description: 생성된 구독 ID
              usage: 구독 관리 페이지 리다이렉트에 사용

    get-subscription:
      url:
      method:
      description: 구독 조회
      pathParams:
        - name:
          description: 구독 ID
      response:
        body:
          fields:
            - name: subscriptionId
              type: string
              required: true
            - name: customerUid
              type: string
              required: true
              description: PortOne 고객 고유 식별자
            - name: planId
              type: string
              required: true
            - name: paymentMethodId
              type: string
              required: false
              description: 결제 수단 ID (결제수단 테이블 참조)
            - name: status
              type: string
              required: true
              description: "구독 상태 (ACTIVE: 활성, CANCELLED: 해지, SUSPENDED: 미납, EXPIRED: 기간 종료)"
            - name: amount
              type: number
              required: true
            - name: currentPeriodEnd
              type: string
              required: true
              description: "현재 이용 기간 종료일 (ISO 8601 형식, 예: 2026-03-01T23:59:59)"

    update-subscription:
      url:
      method:
      description: 구독 상태 업데이트 (구독 해지)
      pathParams:
        - name:
          description: 구독 ID
      request:
        fields:
          - name: action
            type: string
            required: true
            description: "액션 타입: 'cancel' (구독 해지) 등"
          - name: reason
            type: string
            required: false
            description: 해지 사유
      response:
        body:
          fields:
            - name: success
              type: boolean
              required: true
              description: 성공 여부
            - name: subscriptionId
              type: string
              required: false
            - name: status
              type: string
              required: false
              description: 변경된 구독 상태

    create-billing:
      url:
      method:
      description: 즉시 결제 (현재 주기 청구 실행)
      pathParams:
        - name:
          description: 구독 ID
      request:
        fields:
          - name: periodStart
            type: string
            required: true
            description: "청구 기간 시작일 (ISO 8601 형식, 예: 2026-02-01T00:00:00)"
          - name: periodEnd
            type: string
            required: true
            description: "청구 기간 종료일 (ISO 8601 형식, 예: 2026-02-28T23:59:59)"
      response:
        body:
          fields:
            - name: success
              type: boolean
              required: true
            - name: billingId
              type: string
              required: true
              description: 생성된 구독 청구 ID
            - name: paymentId
              type: string
              required: false
              description: 빌링키 결제 시 사용된 결제 건 ID (PortOne)
            - name: amount
              type: number
              required: true
              description: 청구 금액
            - name: status
              type: string
              required: true
              description: "청구 상태 (COMPLETED: 결제 완료, FAILED: 실패)"

    list-billing-history:
      url:
      method:
      description: 청구 내역 조회
      pathParams:
        - name:
          description: 구독 ID
      response:
        body:
          fields:
            - name: billings
              type: array
              required: true
              description: "청구 내역 배열. 각 요소는 { billingId: string (필수), periodStart: string (필수, ISO 8601), periodEnd: string (필수, ISO 8601), amount: number (필수), status: string (필수, COMPLETED/FAILED/PENDING), paymentId: string (선택), attemptDate: string (선택, ISO 8601), failureMessage: string (선택) } 형태"
